<!DOCTYPE html>

<html>
    <head>
        <title>#{get 'title' /}</title>
        <meta charset="${_response_encoding}">
        <link rel="stylesheet" media="screen" href="@{'/public/stylesheets/main.css'}">
       	<link rel="stylesheet" href="@{'/public/stylesheets/redmond/jquery-ui-1.8.14.custom.css'}" type="text/css" media="screen" charset="utf-8"/>
       	<link rel="stylesheet" href="@{'/public/stylesheets/uniform.default.css'}" type="text/css" media="screen" charset="utf-8"/>
       	<link rel="shortcut icon" type="image/png" href="@{'/public/images/favicon.png'}">
       	<script src="@{'/public/javascripts/jquery-1.6.2.min.js'}" type="text/javascript" charset="utf-8"></script>
       	<script src="@{'/public/javascripts/jquery.uniform.js'}" type="text/javascript"></script>
       	<script src="@{'/public/javascripts/jquery-ui-1.8.14.custom.min.js'}" type="text/javascript" charset="utf-8"></script>
        <script src="@{'/public/javascripts/jquery.form.js'}" type="text/javascript"></script>
    </head>
    <body>
    #{form @saveVisit(), id:'visit-form'}
    <input type="hidden" name="visit.pet.id" value="${visit.pet.id}"/>
    <input type="hidden" name="visit.id" value="${visit.id}"/>
    <div id="message"></div>
    <table>
        #{trInput value:visit.date.format(dateFormat), fieldName:'visit.date'/}
        #{trInput value:visit.description, fieldName:'visit.description', type:'textarea'/}
        <div class="actions"><input type="submit" value="&{'save'}" class="btn primary"/></div>
    </table>
    #{/form}
    <script type="text/javascript">
        $(function() {
            function showResponse(json)  {
                if (json.status == 'ok') {
                    location.reload(true);
                }
                else {
                    for (errorField in json.errors) {
                        $("#" + errorField).attr("class", "errorField").after("<span class='errorFieldDescription'>" + json.errors[errorField] + "</span>");
                    }
                }
            }
            function clearPreviousErrors() {
                $(".errorFieldDescription").remove();
            }
            var options = {target: "#message", dataType: 'json', success: showResponse, beforeSubmit: clearPreviousErrors}
            // bind form using 'ajaxForm'
            $("#visit-form").ajaxForm(options);

        });
    </script>
    </body>
</html>
